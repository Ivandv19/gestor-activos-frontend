<main>
  <!-- Sección de búsqueda y filtros -->
  <section class="busqueda">
    <!-- Barra de búsqueda -->
    <div class="barra-de-busqueda">
      <div class="barra-busqueda">
        <div>
          <p>Buscar Activo</p>
        </div>
        <input
          type="text"
          placeholder="Ingresa activo a buscar..."
          (input)="onSearchInput($event)"
        />
      </div>
      <!-- Contenedor de filtros y opciones -->
      <div class="container-filtros">
        <!-- Selector de filtros principales -->
        <div class="filtros">
          <p>Filtro</p>
          <select
            name="filtro"
            id="filtro"
            (change)="cargarOpcionesFiltro($event)"
          >
            <option value="">Selecciona un filtro</option>
            <option value="accion">Accion</option>
            <option value="usuario_responsable">Usuario responsable</option>
          </select>
        </div>

        <!-- Selector de opciones dinámicas -->
        <div class="opciones">
          <p>Opciones</p>
          <select
            name="opciones"
            id="opciones"
            (change)="aplicarFiltro($event)"
          >
            <option value="">Todos</option>
            <!-- Las opciones se llenarán dinámicamente según el filtro elegido -->
          </select>
        </div>

        <!-- Selector de dirección (asc/desc) -->
        <div class="direccion">
          <p>Dirección</p>
          <select
            name="direccion"
            id="direccion"
            (change)="aplicarOrden($event)"
          >
            <option value="asc">Ascendente (A-Z)</option>
            <option value="desc">Descendente (Z-A)</option>
          </select>
        </div>
      </div>
    </div>

    <div class="container-botones">
      <button class="btn-limpiar" (click)="limpiarFiltros()">
        Limpiar Filtros
        <img src="assets/reiniciar-filtros.png" alt="Limpiar" />
      </button>

      <button class="btn-agregar" routerLink="agregar">
        Agregar activo
        <img src="/assets/icono-agregar.png" alt="" />
      </button>
    </div>
  </section>

  <!-- Tabla de historial -->
  <section class="tabla-historial">
    <h2>Historial del Activo</h2>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Acción</th>
          <th>Detalles</th>
          <th>Fecha</th>
          <th>Usuario Responsable</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let registro of historial">
          <!-- Itera sobre los registros del historial -->
          <td>{{ registro.id }}</td>
          <td>
            <span *ngFor="let parte of dividirTexto(registro.accion)">
              <!-- Divide el texto para resaltar coincidencias -->
              <span [class.highlight]="esParteResaltada(parte)">{{
                parte
              }}</span>
              <!-- Aplica clase 'highlight' si coincide -->
            </span>
          </td>
          <td>{{ registro.detalles }}</td>
          <td>{{ registro.fecha | date:'dd/MM/yyyy HH:mm:ss' }}</td>
          <td>{{ registro.usuario_responsable }}</td>
        </tr>
      </tbody>
    </table>
  </section>
  
  <!-- Sección de paginación -->
  <section class="container-paginacion">
    <section class="pagination-info" *ngIf="pagination.total > 0">
      <p>
        Mostrando {{ primerActivoMostrado }}-{{ ultimoActivoMostrado }} de
        {{ pagination.total }} activos
        <!-- Muestra información de la paginación -->
      </p>
    </section>

    <!-- Paginación avanzada -->
    <section class="pagination" *ngIf="pagination.totalPages > 1">
      <!-- Botones Primera página / Anterior -->
      <button (click)="cambiarPagina(1)" [disabled]="paginaActual === 1">
        « Primera |
      </button>
      <!-- Va a la primera página -->
      <button
        (click)="cambiarPagina(paginaActual - 1)"
        [disabled]="paginaActual === 1"
      >
        « Anterior |
      </button>
      <!-- Va a la página anterior -->

      <!-- Números de página -->
      <span *ngFor="let pagina of paginasVisibles">
        <button
          (click)="cambiarPagina(pagina)"
          [class.active]="pagina === paginaActual"
        >
          <!-- Resalta la página actual -->
          {{ pagina }}
        </button>
      </span>

      <!-- Botones Siguiente / Última página -->
      <button
        (click)="cambiarPagina(paginaActual + 1)"
        [disabled]="paginaActual === pagination.totalPages"
      >
        <!-- Deshabilita si estás en la última página -->
        | Siguiente »
      </button>
      <button
        (click)="cambiarPagina(pagination.totalPages)"
        [disabled]="paginaActual === pagination.totalPages"
      >
        <!-- Deshabilita si estás en la última página -->
        | Última »
      </button>
    </section>

    <!-- Selector de límite por página -->
    <section class="limite-pagina">
      <p>Mostrar:</p>
      <select (change)="onLimitChange($event)">
        <!-- Cambia el número de elementos por página -->
        <option value="10" [selected]="limitePorPagina === 10">10</option>
        <option value="20" [selected]="limitePorPagina === 20">20</option>
        <option value="50" [selected]="limitePorPagina === 50">50</option>
      </select>
    </section>
  </section>


</main>
